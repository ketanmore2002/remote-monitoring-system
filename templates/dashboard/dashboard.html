{% load static %}
{% comment %} {% load custom_filters %} {% endcomment %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="{% static '/dashboard/styles.css' %}">
  <!-- Load plotly.js into the DOM -->
  <script src="{% static '/dashboard/plotly-2.20.0.min.js' %}" charset="utf-8"></script>
</head>

<body>
  <div class="sidebar">
    <br>
    <br>
    <img class="logo" src="{% static 'images/logo.jpg' %}" alt="Icon">
    <br>
    <a href="/">Home</a>
    <a href="#">Site Details</a>
    <a href="#">Log Out</a>
    <!-- <footer><img src="solarPump.png"> </footer> -->
  </div>
  <div class="row">
    <div class="nav">
      <table class="navbartable">
        <tr>
          <th></th>
          <th></th>
          <th>
            <h1>Solar Water Pump Remote Monitoring System</h1>
          </th>
          <th></th>
          <th>Login By : <br>{{request.user.username}}<br> 11/08/2023 </th>
        </tr>
      </table>
    </div>
  </div>
  <div class="row">
    <div class="testingLeftHalf">
      <table>
        <tr>
          <th><label class="label">Pump <br> Start Time</label><br>
            <button class="digitalclock">{{data2.start_time}}</button><br>
          </th>
        </tr>
        <br>
        <tr>
          <th><label class="label">Pump <br> Stop Time</label><br>
            <button class="digitalclock">{{data2.stop_time}}</button><br>
          </th>
        </tr>
        <br>
        <tr>
          <th><label class="label">Today's <br> Run Time</label><br>
            <button class="digitalclock">{{ run_time }}</button><br>
          </th>
        </tr>
        <th><label class="label">Signal <br> Strength</label><br>
          <button class="digitalclock">{{data.signal_strength}} %</button><br>
        </th>
      </table>
    </div>
    <div class="testingRightHalf">
      <table>
        <tr>
          <th><label class="label">Benificery Name</label><input class="dashboardInput" name="dashboardInput"
              id="">{{data.benificery_name}}</th>
          <th><label class="label">RMD ID</label><input class="dashboardInput" name="dashboardInput" id="">{{data.rms}}
          </th>
          <th><label class="label">Capacity</label><input class="dashboardInput" name="dashboardInput"
              id="">{{data.capacity}}</th>
          <th><label class="label">Head</label><input class="dashboardInput" name="dashboardInput" id="">did not
            understand</th>
          <th><label class="label">Site Address</label><input class="dashboardInput" name="dashboardInput"
              id="">{{data.location}}
          </th>
        </tr>
      </table>
      <table class="dashboardinfo">
        <tr>
          <th></th>
          <th><img src="{% static '/dashboard/motor.png' %}"></th>
          <th>Pump Status <br>
            <h2>{{data.pump_status}}</h2>
          </th>
          <th>
            <div id='myDiv1'><!-- Plotly chart will be drawn inside this DIV --></div>
          </th>

        </tr>

        <tr>
          <th></th>
          <th><img src="{% static '/dashboard/lpd.png' %}"></th>
          <th> Commulative LPD<br>
            <h2>{{data2.cumulative_lpd}} L</h2>
          </th>
          <th>
            <div id='myDiv2'><!-- Plotly chart will be drawn inside this DIV --></div>
          </th>

        </tr>
        <th></th>
        <th><img src="{% static '/dashboard/lpm.png' %}"></th>
        <th>Present LPM<br>
          <h2>{{data2.present_lpm}} L</h2>
        </th>
        <th>
          <div id='myDiv3'><!-- Plotly chart will be drawn inside this DIV --></div>
        </th>
        </tr>
      </table>
      <table class="todayDataTable">
        <tr>
          <th>Start<br>Time</th>
          <th>Cummulative<br>LPD</th>
          <th>Present<br>LPM</th>
          <th>Voltage</th>
          <th>Current</th>
          <th>Power</th>
          <th>Signal<br>Strength</th>
          <th>Time<br>stamp</th>
          <th>Stop<br>Time</th>
          <th>Running<br>hours</th>
        </tr>

        {% for i in data3 %}
        <tr>
          <td>{{i.start_time}}</td>
          <td>{{i.cumulative_lpd}} Lit</td>
          <td>{{i.present_lpm}} Lit</td>
          <td>{{i.voltage}}</td>
          <td>{{i.current}}</td>
          <td>{{i.power}}</td>
          <td>{{i.signal_strength}}</td>
          <td>{{i.time}}</td>
          <td>{{i.stop_time}}</td>
          <td>{{i.run_time_today}}</td>
        </tr>
        {% endfor %}
      </table>
    </div>
    </table>
    </form>
    </section>
  </div>


  <script src="https://code.jquery.com/jquery-3.7.0.min.js"
      integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>


    <script>
      $(document).ready(function () {

        window.addEventListener("load", () => {

        })
        var data = [
          {
            domain: { x: [0, 1], y: [0, 1] },
            value: 100,
            title: { text: "", font: { size: 14, family: "Cambria, Cochin, Georgia, Times, 'Times New Roman', serif", bold: true, color: "green" } },
            type: "indicator",
            mode: "gauge",
            gauge: {
              axis: {
                range: [0, 120],
                tickvals: [0, 20, 40, 60, 80, 100, 120],
                tickfont: {  // Adding font settings for the tick labels
                  size: 10,  // Specify the desired font size for the tick labels
                  family: "Arial, sans-serif",  // Specify the font family for the tick labels
                  color: "black"  // Specify the font color for the tick labels
                }
              }
            }
          }
        ];
        var layout = {
          width: 350,
          height: 120,
          margin: { t: 0, b: 0 },
          grid: { rows: 1, columns: 1, pattern: 'independent' },
          annotations: [
            {
              x: 0.5, // Adjust x position to move the data horizontally
              y: 0.3, // Adjust y position to move the data vertically
              text: "Voltage (V)",
              showarrow: false,
              font: { size: 14, color: "green", family: "Cambria, Cochin, Georgia, Times, 'Times New Roman', serif", bold: true }
            }
          ]
        };
        Plotly.newPlot('myDiv1', data, layout);
        var data = [
          {
            domain: { x: [0, 1], y: [0, 1.5] },
            value: 10,
            title: { text: "", font: { size: 14, family: "Cambria, Cochin, Georgia, Times, 'Times New Roman', serif", bold: true, color: "green" } },
            type: "indicator",
            mode: "gauge",
            gauge: {
              axis: {
                range: [0, 15],
                tickvals: [0, 5, 10, 15],
                tickfont: {  // Adding font settings for the tick labels
                  size: 10,  // Specify the desired font size for the tick labels
                  family: "Arial, sans-serif",  // Specify the font family for the tick labels
                  color: "black"  // Specify the font color for the tick labels
                }
              }
            }
          }
        ];
        var layout = {
          width: 350,
          height: 120,
          margin: { t: 0, b: 0 },
          grid: { rows: 1, columns: 1, pattern: 'independent' },
          annotations: [
            {
              x: 0.5, // Adjust x position to move the data horizontally
              y: 0.3, // Adjust y position to move the data vertically
              text: "Current (A)",
              showarrow: false,
              font: { size: 14, color: "green", family: "Cambria, Cochin, Georgia, Times, 'Times New Roman', serif", bold: true }
            }
          ]
        };
        Plotly.newPlot('myDiv2', data, layout);
        var data = [
          {
            domain: { x: [0, 1], y: [0, 1.5] },
            value: 450,
            title: { text: "", font: { size: 14, family: "Cambria, Cochin, Georgia, Times, 'Times New Roman', serif", bold: true, color: "green" } },
            type: "indicator",
            mode: "gauge",
            gauge: {
              axis: {
                range: [0, 1000],
                tickvals: [0, 200, 400, 600, 800, 1000],
                tickfont: {  // Adding font settings for the tick labels
                  size: 10,  // Specify the desired font size for the tick labels
                  family: "Arial, sans-serif",  // Specify the font family for the tick labels
                  color: "black"  // Specify the font color for the tick labels
                }
              }
            }
          }
        ];
        var layout = {
          width: 350,
          height: 120,
          margin: { t: 0, b: 0 },
          grid: { rows: 1, columns: 1, pattern: 'independent' },
          annotations: [
            {
              x: 0.5, // Adjust x position to move the data horizontally
              y: 0.3, // Adjust y position to move the data vertically
              text: "Power (W)",
              showarrow: false,
              font: { size: 14, color: "green", family: "Cambria, Cochin, Georgia, Times, 'Times New Roman', serif", bold: true }
            }
          ]
        };
        Plotly.newPlot('myDiv3', data, layout);


        function task_data() {
          //create_token();
          //headers_payload = {'Authorization': 'Bearer ' + y,'Content-type':'application/json'};
          $.ajax({
            url: "/task_data/",
            data: {},
            //headers: headers_payload,
            type: "GET",
            contentType: "application/json",
            success: function (result) {
             if(result == "incomplete"){
              location.reload(true);
             }
            }
          });
        };
        setInterval(task_data, 2000);
      

      });
    </script>

</body>

</html>